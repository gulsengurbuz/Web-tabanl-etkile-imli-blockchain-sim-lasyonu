<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zaman DamgasÄ± AÃ§Ä±klayÄ±cÄ±</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="../../quizbtn.css" />
  </head>
  <body>
    <div class="container">
      <h1>Zaman DamgasÄ± AÃ§Ä±klayÄ±cÄ±</h1>

      <div id="modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <span id="modal-icon" class="modal-icon">ğŸ“…</span>
            <h2 id="modal-title">Zaman DamgasÄ± Nedir?</h2>
          </div>
          <p id="modal-text">
            Bir verinin oluÅŸturulduÄŸu anÄ± ispatlayan dijital mÃ¼hÃ¼rdÃ¼r.
            Blockchain'e kaydedildiÄŸinde, bu zaman bilgisi deÄŸiÅŸtirilemez ve
            gÃ¼vence altÄ±na alÄ±nÄ±r.
          </p>
          <button id="modal-close" class="modal-button">AnladÄ±m</button>
        </div>
      </div>

      <div id="animation-container" class="animation-container">
        <div id="step1-animation" class="step-animation">
          <div id="data-box" class="data-box">Ali â†’ 5 BTC â†’ Zeynep</div>
          <div id="golden-seal" class="golden-seal">
            <span id="timestamp-text" class="timestamp-text"
              >12.08.2025 â€“ 14:32</span
            >
          </div>
        </div>

        <div id="step2-animation" class="step-animation">
          <div id="data-box-2" class="data-box left-position">Veri Kutusu</div>
          <div id="particles" class="particles"></div>
          <div id="hash-box" class="hash-box">HASH</div>
          <div id="datetime-tag" class="datetime-tag">Dijital Zaman</div>
          <div id="certificate" class="certificate">
            Zaman DamgasÄ± SertifikasÄ±
          </div>
          <div id="blockchain-line" class="blockchain-line">
            <div id="empty-block" class="blockchain-block">
              <span id="block-content">BoÅŸ Blok</span>
              <div id="check-icon" class="check-icon">âœ“</div>
            </div>
            <div id="chain-link" class="chain-link"></div>
          </div>
        </div>

        <div id="step3-animation" class="step-animation">
          <div id="blockchain-line-3" class="blockchain-line">
            <div id="stamped-block" class="blockchain-block highlighted">
              <div id="seal-3" class="seal">âœ“</div>
            </div>
          </div>
          <div id="attacker" class="attacker">
            <div class="attacker-icon">ğŸ‘¤</div>
            <p>SaldÄ±rgan</p>
          </div>
          <div id="original-data" class="data-box original-data">
            Orijinal Veri: Ali â†’ 5 BTC â†’ Zeynep
            <div class="status valid">âœ“ DoÄŸrulandÄ±</div>
          </div>
          <div id="modified-data" class="data-box modified-data">
            DeÄŸiÅŸtirilmiÅŸ Veri: Ali â†’ <span id="btc-amount">5 BTC</span> â†’
            Zeynep
            <div id="invalid-status" class="status invalid">âœ— GeÃ§ersiz</div>
          </div>
        </div>

        <div id="step4-animation" class="step-animation">
          <div id="final-lock" class="final-lock">
            <div class="lock-icon">ğŸ”’</div>
            <p>GÃ¼ven SaÄŸlandÄ±</p>
          </div>
          <div id="blockchain-line-4" class="blockchain-line">
            <div id="focused-block" class="blockchain-block">
              <div id="certificate-seal" class="certificate-seal">
                Sertifika
              </div>
            </div>
            <div class="blockchain-block verified">âœ“</div>
            <div class="blockchain-block verified">âœ“</div>
            <div class="blockchain-block verified">âœ“</div>
          </div>
          <div id="explanation-icons" class="explanation-icons">
            <div class="icon-item">
              <div class="icon">ğŸ“…</div>
              <p>OluÅŸturulma zamanÄ± kanÄ±tlanÄ±r</p>
            </div>
            <div class="icon-item">
              <div class="icon">ğŸ”</div>
              <p>DeÄŸiÅŸiklikler anÄ±nda fark edilir</p>
            </div>
            <div class="icon-item">
              <div class="icon">ğŸ›¡ï¸</div>
              <p>KayÄ±tlar kalÄ±cÄ± ve gÃ¼venlidir</p>
            </div>
          </div>
        </div>
      </div>

      <button id="next-step" class="next-step-button">Sonraki AdÄ±m</button>
    </div>

    <button id="finishAnim">Animasyonu Bitir</button>
    <script type="module">
      import { markAnimationProgress } from "../../../shared/progress-client.js";

      document
        .getElementById("finishAnim")
        .addEventListener("click", async () => {
          try {
            await markAnimationProgress(2, "zaman-damgasi", 100);
            window.location.href = "../../../testler/zamandamgasÄ±/index.html";
          } catch (e) {
            alert(e.message || e);
          }
        });
    </script>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script type="module" src="../../../firebase-init.js"></script>
    <script type="module" src="../../../shared/track-anim.js"></script>
    <script type="module">
      import { auth, db } from "../../../firebase-init.js";
      import {
        doc,
        setDoc,
        serverTimestamp,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      console.log("trackAnimation var mÄ±? =>", typeof window.trackAnimation);

      console.log("uid =>", auth.currentUser?.uid || "(yok)");

      const slug = "zaman-damgasi";
      try {
        const c = await getDoc(doc(db, "catalogAnimations", slug));
        console.log("catalogAnimations/" + slug, "exists:", c.exists());
      } catch (e) {
        console.warn("catalog kontrolÃ¼ hata:", e);
      }

      window.trackAnimation?.({
        id: "zaman-damgasi",

        minSeconds: 2,
        minPercent: 0.2,
      });
      window.__forceWrite = async () => {
        const uid = auth.currentUser?.uid;
        if (!uid) {
          console.warn("GiriÅŸ yok");
          return;
        }
        await setDoc(
          doc(db, "users", uid, "progressAnimations", slug),
          {
            id: slug,
            watchedAt: serverTimestamp(),
            percent: 1,
            seconds: 10,
            sourceUrl: location.pathname,
          },
          { merge: true }
        );
        console.log("Manuel yazÄ±ldÄ±.");
      };
    </script>

    <script type="module">
      window.trackAnimation({ id: "zaman-damgasi" });
    </script>
    <script src="script.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        lucide.createIcons();
      });
    </script>
  </body>
</html>
